<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
  <%= javascript_include_tag 'jquery-1.4.2.min' %>
  <%= javascript_include_tag 'pure.min' %>
  <%= javascript_include_tag 'underscore.min' %>
  <%= javascript_include_tag 'highcharts' %>
  <!--[if IE]>
    <script src="/javascripts/excanvas.compiled.js" type="text/javascript"></script>
  <![endif]-->
  
  <%= javascript_include_tag 'politiwidgets' %>
  <%= javascript_include_tag 'politiwidgets_embed' %>
  
  <script type="text/javascript">
    var data_endpoint = "<%= settings[:data_endpoint] %>";
    var sunlight_api_key = "<%= settings[:sunlight_api_key] %>";
    var snapshot_directory = "<%= settings[:snapshot_directory] %>";
    
    var bioguide_id = "<%= params[:bioguide_id] %>".toUpperCase();
    var size = "<%= @size %>";
    var snapshot_id = "<%= params[:snapshot_id] %>";
    
    
    // The main widget loading function. If a snapshot_id is set, it'll use that, otherwise, 
    // it'll use the given Drumbone parameters to pull from the live site.
    function loadWidget(method, sections, options, callback) {
      var augmented = function(data) {
        if (data.error)
          setError("Error loading widget.<br/><br/>Error message: " + data.error.code + " - " + data.error.message);
        else
          callback(data);
        
        $("div#sources a.sourceText").toggle(
          function(){
            $(this).addClass("active");
            $("div#sourceArea").slideDown("slow");
            $(".highcharts-container").hide();
            return false;
          },
          function() {
            $(this).removeClass("active");
            $("div#sourceArea").slideUp("slow", function() {
              $(".highcharts-container").show();        
            });
            
            return false;
          } 
        );
      
        $("body").show();
      };
      
      
      var url;
      if (snapshot_id)
        url = snapshotUrl(snapshot_directory, snapshot_id);
      else {
        url = drumboneUrl(data_endpoint, method, $.extend(options, {
          apikey: sunlight_api_key,
          sections: sections.join(",")
        }));
      }
      

      return $.ajax({
        url: url,
        dataType: "jsonp",
        jsonpCallback: "politiwidgetsCallback",
        success: augmented
      });
    }
  </script>
  
  <!--[if IE 6]>
    <%= stylesheet_link_tag 'widgets-buggy' %>
  <![endif]-->
  <!--[if IE 7]>
    <%= stylesheet_link_tag 'widgets-buggy7' %>
  <![endif]-->
  <%= stylesheet_link_tag 'widget' %>
  
  <%= yield :head %>
</head>

<body class="<%= yield :body_class %>">

  <div id="widgetAlert" class="alert">
    <p></p>
  </div>
  
  <div id="pageMain">
  
    <%= yield %>
    
    <div id="sources">
      <a class="sourceText" href="#">Source Info</a>
      <div id="sourceArea">
        <p>
          <span id="sourceContent"></span>
          <span class="last_updated_container">
            Last updated: <span id="last_updated">00/00/00</span>
          </span>
        </p>
      </div>
    </div>
  </div>
  
  
  <%= render :partial => "layouts/analytics" %>
  
  <script type="text/javascript">
    // stub to be overridden, this whole thing is a big IE hack
    function doneLoadingMap() {}
  </script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&callback=doneLoadingMap"></script>
</body>

</html>