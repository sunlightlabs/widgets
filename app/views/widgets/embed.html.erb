<% content_for :head do %>
  <%= stylesheet_link_tag "widgets/#{params[:id]}" %>
  
  <%= javascript_include_tag 'transparency_data' %>
  <%= javascript_include_tag 'drumbone' %>
  
  <script type="text/javascript">
    var data_endpoint = "<%= settings[:data_endpoint] %>";
    var sunlight_api_key = "<%= settings[:sunlight_api_key] %>";
    var snapshot_directory = "<%= settings[:snapshot_directory] %>";
    
    var bioguide_id = "<%= params[:bioguide_id] %>".toUpperCase();
    var size = "<%= @size %>";
    var snapshot_id = "<%= params[:snapshot_id] %>";
    
    Drumbone.base_url = data_endpoint;
    Drumbone.api_key = sunlight_api_key;
    TransparencyData.api_key = sunlight_api_key;
    
    function showWidget() {
      $("div#sources a.sourceText").toggle(
        function(){
          $(this).addClass("active");
          $("div#sourceArea").slideDown("slow");
          $(".highcharts-container").hide();
          return false;
        },
        function() {
          $(this).removeClass("active");
          $("div#sourceArea").slideUp("slow", function() {
            $(".highcharts-container").show();        
          });
          
          return false;
        } 
      );

      $("body").show();
    }

    function setAlert(message) {
      $("#pageMain").hide();
      $("#widgetAlert p").html(message);
      $("#widgetAlert").show();
      $("body").show();
    }

    function setError(message) {
      $("#widgetAlert").addClass("error");
      setAlert(message);
    }

    function updateSource(date, text) {
      $("#last_updated").html(formatSourceDate(new Date(date)));
      $("#sourceContent").html(text);
    }
  </script>
<% end %>

<% content_for :body_class, "#{params[:id]}_#{params[:size]} #{params[:size]}" %>

<%= render "widgets/embed/#{params[:id]}" %>